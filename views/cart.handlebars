<div class="content">
    <div style="margin-bottom: 20px;">
        <a href="/products" style="display: inline-block; padding: 10px 20px; background: #667eea; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; margin-right: 10px;">
            ‚Üê Volver a productos
        </a>
    </div>

    <h1 style="color: #333; margin-bottom: 30px; font-size: 2.5rem;">Carrito de Compras</h1>
    
    {{#if hasProducts}}
        <div class="cart-container" style="background: #f8f9fa; border-radius: 10px; padding: 30px; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
            <div style="margin-bottom: 20px;">
                <strong style="color: #555; font-size: 1.1rem;">ID del Carrito:</strong>
                <code style="background: #fff; padding: 5px 10px; border-radius: 5px; margin-left: 10px; font-family: monospace;">{{cartId}}</code>
            </div>

            <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; margin-bottom: 20px;">
                <thead>
                    <tr style="background: #667eea; color: white;">
                        <th style="padding: 15px; text-align: left; border-bottom: 2px solid #ddd;">Producto</th>
                        <th style="padding: 15px; text-align: center; border-bottom: 2px solid #ddd;">Categor√≠a</th>
                        <th style="padding: 15px; text-align: center; border-bottom: 2px solid #ddd;">Precio Unitario</th>
                        <th style="padding: 15px; text-align: center; border-bottom: 2px solid #ddd;">Cantidad</th>
                        <th style="padding: 15px; text-align: right; border-bottom: 2px solid #ddd;">Subtotal</th>
                        <th style="padding: 15px; text-align: center; border-bottom: 2px solid #ddd;">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each products}}
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 15px;">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div style="font-size: 3rem;">üì¶</div>
                                <div>
                                    <strong style="color: #333; font-size: 1.1rem;">{{this.title}}</strong>
                                    <br>
                                    <small style="color: #666; font-family: monospace;">{{this.code}}</small>
                                </div>
                            </div>
                        </td>
                        <td style="padding: 15px; text-align: center;">
                            <span style="background: #764ba2; color: white; padding: 5px 15px; border-radius: 15px; font-size: 0.9rem;">
                                {{this.category}}
                            </span>
                        </td>
                        <td style="padding: 15px; text-align: center; font-weight: bold; color: #667eea;">
                            ${{this.price}}
                        </td>
                        <td style="padding: 15px; text-align: center;">
                            <span style="background: #f8f9fa; padding: 5px 15px; border-radius: 5px; font-weight: bold; font-size: 1.1rem;">
                                {{this.quantity}}
                            </span>
                        </td>
                        <td style="padding: 15px; text-align: right; font-weight: bold; color: #28a745; font-size: 1.1rem;">
                            ${{this.subtotal}}
                        </td>
                        <td style="padding: 15px; text-align: center;">
                            <button onclick="removeProduct('{{this._id}}')" style="padding: 8px 15px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                                Eliminar
                            </button>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>

            <div style="background: white; border-radius: 10px; padding: 25px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <span style="font-size: 1.5rem; font-weight: bold; color: #333;">Total del Carrito:</span>
                    <span style="font-size: 2rem; font-weight: bold; color: #28a745;">${{total}}</span>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="clearCart()" style="padding: 12px 30px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 1.1rem; margin-right: 10px;">
                        Vaciar Carrito
                    </button>
                    <button onclick="checkout()" style="padding: 12px 30px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 1.1rem;">
                        Finalizar Compra
                    </button>
                </div>
            </div>
        </div>
    {{else}}
        <div class="empty-cart" style="background: #f8f9fa; border-radius: 10px; padding: 60px; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
            <div style="font-size: 5rem; margin-bottom: 20px;">üõí</div>
            <h2 style="color: #666; margin-bottom: 15px;">Tu carrito est√° vac√≠o</h2>
            <p style="color: #999; margin-bottom: 30px; font-size: 1.1rem;">Agrega productos para comenzar a comprar</p>
            <a href="/products" style="display: inline-block; padding: 15px 30px; background: #667eea; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 1.1rem;">
                Ver Productos
            </a>
        </div>
    {{/if}}
</div>

<div id="notification" style="position: fixed; top: 20px; right: 20px; padding: 15px 25px; background: #28a745; color: white; border-radius: 5px; display: none; z-index: 1000; box-shadow: 0 3px 10px rgba(0,0,0,0.3); font-weight: bold;"></div>

<script>
    const cartId = '{{cartId}}';

    async function removeProduct(productId) {
        if (!confirm('¬øEst√°s seguro de que deseas eliminar este producto del carrito?')) {
            return;
        }

        try {
            const response = await fetch(`/api/carts/${cartId}/products/${productId}`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
            });

            const data = await response.json();

            if (data.status === 'success') {
                showNotification('Producto eliminado del carrito', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                showNotification(data.message, 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showNotification('Error al eliminar producto', 'error');
        }
    }

    async function clearCart() {
        if (!confirm('¬øEst√°s seguro de que deseas vaciar todo el carrito?')) {
            return;
        }

        try {
            const response = await fetch(`/api/carts/${cartId}`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
            });

            const data = await response.json();

            if (data.status === 'success') {
                showNotification('Carrito vaciado', 'success');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            } else {
                showNotification(data.message, 'error');
            }
        } catch (error) {
            console.error('Error:', error);
            showNotification('Error al vaciar carrito', 'error');
        }
    }

    function checkout() {
        alert('Proceso de compra - Pr√≥ximamente disponible');
    }

    function showNotification(message, type) {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.style.background = type === 'success' ? '#28a745' : '#dc3545';
        notification.style.display = 'block';

        setTimeout(() => {
            notification.style.display = 'none';
        }, 3000);
    }
</script>